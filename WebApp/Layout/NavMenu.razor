@using Core
@using WebApp.Components
@inject WebApp.Service.AuthServices.IAuthService AuthService

<nav class="navbar navbar-expand-lg navbar-light bg-light px-4">
    <a class="navbar-brand fw-bold" href="">Kortklub</a>

    <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
            <li class="nav-item"><NavLink class="nav-link" href="">Forside</NavLink></li>
            <li class="nav-item"><NavLink class="nav-link" href="boder">Bøder</NavLink></li>
            <li class="nav-item"><NavLink class="nav-link" href="highlights">Highlights</NavLink></li>
            <li class="nav-item"><NavLink class="nav-link" href="users">Medlemmer</NavLink></li>
            <li class="nav-item"><NavLink class="nav-link" href="RulesPage">Regler</NavLink></li>
            <li class="nav-item"><NavLink class="nav-link" href="WhistSchemePage">Skema</NavLink></li>
        </ul>

        <button class="btn btn-outline-primary ms-auto" @onclick="ToggleLogin">
            @(_currentUser is null ? "Log ind" : "Log ud")
        </button>
    </div>

    <LoginComponent @ref="_loginComponent" OnLoginSuccess="HandleLoginSuccess" />
</nav>

@code {
    private Core.User? _currentUser;
    private LoginComponent? _loginComponent;

    protected override async Task OnInitializedAsync()
    {
        _currentUser = await AuthService.GetCurrentUser();
    }

    private async Task HandleLoginSuccess()
    {
        _currentUser = await AuthService.GetCurrentUser();
        StateHasChanged();
    }

    private async Task ToggleLogin()
    {
        if (_currentUser is null)
        {
            _loginComponent?.Show(); // Åbn login-dialog
        }
        else
        {
            await AuthService.Logout(); // Log ud
            _currentUser = null;
            StateHasChanged();
        }
    }
}