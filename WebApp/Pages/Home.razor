@page "/"
@using WebApp.Service

@inject IUserService UserService
@inject Service.HighlightServices.IHighlightService HighlightService

<!--
    HOME:
    - Intro + tekst
    - Samler billed-URLs fra:
        1) Brugeres profilbilleder
        2) Highlights billeder (kun ikke-private)
    - Viser dem som et "uendeligt" slideshow via CSS animation (ikke JS/timer).
-->
<div class="home text-center mt-4">

    <!-- Overskrift/intro -->
    <h1 class="display-4 fw-bold">Velkommen til Whist-holdet</h1>
    <p class="lead fst-italic mb-4">
        Kortene flyver, Irish coffeeen flyder, og bøderne falder
    </p>

    <!-- Hero-billede -->
    <img class="home-hero-image"
         src="Images/Cards.png"
         alt="Kortspil" />

    <!-- Intro-tekst (centreret container, men venstrejusteret tekst) -->
    <div class="home-text">
        <p>
            Velkommen til vores lille digitale klubhus – et sted hvor vi holder styr på bøder, skæve highlights og alle de små ting, der gør vores spilleaftener til noget særligt.
        </p>

        <p>
            Her finder du alt det, der binder vores aftener sammen: hvem der skylder hvad, hvilke regler vi har, og sjove øjeblikke vi aldrig helt glemmer (men heldigvis har skrevet ned). Vi spiller mest Whist, men alt fra quiz til minigolf har udløst både grin, bøder og legendariske hændelser.
        </p>

        <p>
            Så tag et kig rundt, genbesøg nogle af de bedste øjeblikke, eller hold styr på hvem der skylder fadøllen næste gang. Det hele starter og slutter med en god hånd kort og lidt kærligt kaos.
        </p>
    </div>

    <!-- Slideshow (uendeligt loop ved at duplikere listen) -->
    @if (ImageUrls.Count > 0)
    {
        <div class="slideshow" aria-label="Billedslideshow">
            <div class="slideshow-track">
                @* Første runde *@
                @foreach (var url in ImageUrls)
                {
                    <img src="@url" class="slideshow-image" alt="Whist billede" />
                }

                @* Duplikat runde (seamless loop) *@
                @foreach (var url in ImageUrls)
                {
                    <img src="@url" class="slideshow-image" alt="Whist billede" />
                }
            </div>
        </div>
    }
    else
    {
        <p>Ingen billeder endnu…</p>
    }

</div>

@code {
    // Liste af billed-URLs som vises i slideshowet
    private List<string> ImageUrls = new();

    protected override async Task OnInitializedAsync()
    {
        // 1) Hent data fra services
        var users = await UserService.GetAll();
        var highlights = await HighlightService.GetAll();

        // 2) Profilbilleder fra users
        ImageUrls = users
            .Where(u => !string.IsNullOrEmpty(u.ImageUrl))
            .Select(u => u.ImageUrl!)
            .ToList();

        // 3) Offentlige highlight-billeder (ikke private)
        ImageUrls.AddRange(highlights
            .Where(h => !string.IsNullOrEmpty(h.ImageUrl) && !h.IsPrivate)
            .Select(h => h.ImageUrl!));
    }
}
